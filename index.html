<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta property="og:title" content='new Date("wtf")'>
  <meta property="og:description" content="How well do you know JavaScript's Date class?">
  <meta property="og:url" content="https://jsdate.wtf">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://jsdate.wtf/og.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="jsdate.wtf">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content='new Date("wtf")'>
  <meta name="twitter:description" content="How well do you know JavaScript's Date class?">
  <meta name="twitter:image" content="https://jsdate.wtf/og.png">

  <title>The JavaScript Date Quiz</title>
  <style>
    :root {
      --wong-orange: #E69F00;
      --wong-orange-dark: #CC8800;
      --wong-sky-blue: #56B4E9;
      --wong-bluish-green: #009E73;
      --wong-yellow: #F0E442;
      --wong-blue: #0072B2;
      --wong-blue-dark: #005A8F;
      --wong-vermillion: #D55E00;
      --wong-red-purple: #CC79A7;
      --wong-black: #000000;
      --wong-grey: #999999;

      --gray-50: #F5F5F5;
      --gray-100: #E5E5E5;
      --gray-200: #D4D4D4;
      --gray-300: #B0B0B0;
      --gray-400: #737373;
      --gray-500: #525252;
      --gray-600: #404040;
      --gray-700: #2A2A2A;
      --gray-800: #1A1A1A;
      --gray-900: #0F0F0F;

      --white: #FFFFFF;
      --black: #000000;
    }

    :root {
      --color-primary: var(--wong-orange);
      --color-primary-hover: var(--wong-orange-dark);
      --color-secondary: var(--wong-blue);
      --color-secondary-hover: var(--wong-blue-dark);

      --color-bg-dark: var(--gray-900);
      --color-bg-medium: var(--gray-800);
      --color-bg-light: var(--gray-700);
      --color-bg-lighter: var(--gray-600);

      --color-text-primary: var(--gray-50);
      --color-text-secondary: var(--gray-300);

      --color-border: var(--gray-600);
      --color-border-hover: var(--gray-500);
      --color-border-light: var(--gray-500);

      --color-error: var(--wong-vermillion);
      --color-correct-bg: rgba(0, 158, 115, 0.15);
      --color-incorrect-bg: rgba(213, 94, 0, 0.15);
      --color-accent-green: var(--wong-bluish-green);
      --color-code-bg: var(--gray-900);

      --shadow-strength: 0.5;

      --syntax-keyword: var(--wong-sky-blue);
      --syntax-string: var(--wong-bluish-green);
      --syntax-number: var(--wong-yellow);
      --syntax-operator: var(--gray-300);
      --syntax-function: var(--wong-orange);
      --syntax-comment: var(--gray-300);

      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 12px;
      --spacing-lg: 15px;
      --spacing-xl: 20px;
      --spacing-2xl: 25px;
      --spacing-3xl: 30px;
      --spacing-4xl: 40px;

      --font-system: Avenir, Montserrat, Corbel, 'URW Gothic', source-sans-pro, sans-serif;
      --font-mono: ui-monospace, 'Cascadia Mono', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace;
      --font-size-sm: 0.9em;
      --font-size-base: 1em;
      --font-size-lg: 1.1em;
      --font-size-xl: 2em;
      --font-size-2xl: 2.5em;
      --font-size-3xl: 3em;
      --line-height: 1.6;

      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;

      --shadow-default: 0 4px 20px rgba(0, 0, 0, var(--shadow-strength));
      --shadow-subtle: 0 2px 8px rgba(0, 0, 0, calc(var(--shadow-strength) * 0.6));

      --container-max-width: 600px;

      --border-thin: 1px;
      --border-medium: 2px;
      --border-thick: 4px;

      --option-key-size: 30px;
    }

    [data-theme="light"] {
      --color-primary: var(--wong-orange-dark);
      --color-primary-hover: #B36A00;
      --color-secondary: var(--wong-blue-dark);
      --color-secondary-hover: #004A7A;

      --color-bg-dark: var(--white);
      --color-bg-medium: #F7F7F7;
      --color-bg-light: var(--gray-100);
      --color-bg-lighter: var(--gray-200);

      --color-text-primary: var(--gray-800);
      --color-text-secondary: var(--gray-400);

      --color-border: var(--gray-200);
      --color-border-hover: var(--gray-300);
      --color-border-light: var(--gray-200);

      --color-error: var(--wong-vermillion);
      --color-correct-bg: rgba(0, 158, 115, 0.1);
      --color-incorrect-bg: rgba(213, 94, 0, 0.1);
      --color-accent-green: var(--wong-bluish-green);
      --color-code-bg: var(--gray-50);

      --shadow-strength: 0.15;

      --syntax-keyword: var(--wong-blue);
      --syntax-string: var(--wong-bluish-green);
      --syntax-number: var(--wong-orange-dark);
      --syntax-operator: var(--gray-300);
      --syntax-function: var(--wong-orange-dark);
      --syntax-comment: var(--gray-400);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-system);
      background-color: var(--color-bg-dark);
      color: var(--color-text-primary);
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: var(--spacing-xl);
      line-height: var(--line-height);
    }

    @supports (height: 100dvh) {
      body {
        height: 100dvh;
      }
    }

    .container {
      max-width: 800px;
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    #startScreen,
    #quizScreen,
    #resultsScreen {
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      padding: var(--spacing-xl);
    }

    @supports (height: 100dvh) {

      .container,
      #startScreen,
      #quizScreen,
      #resultsScreen {
        height: 100dvh;
      }
    }

    #startScreen {
      justify-content: space-between;
    }

    .start-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--spacing-2xl);
      flex: 1;
      justify-content: center;
    }

    #quizScreen {
      justify-content: flex-start;
      gap: var(--spacing-lg);
    }

    #resultsScreen {
      justify-content: center;
      gap: var(--spacing-2xl);
    }

    #startScreen.hidden,
    #quizScreen.hidden,
    #resultsScreen.hidden {
      display: none;
    }

    header {
      text-align: center;
    }

    .progress {
      align-self: flex-start;
      width: 100%;
    }

    .options {
      align-self: stretch;
      width: 100%;
      margin-top: auto;
    }

    #nextButton {
      align-self: center;
      visibility: hidden;
    }

    #nextButton:not(.hidden) {
      visibility: visible;
    }

    #nextButton.hidden {
      visibility: hidden;
      display: block;
    }

    h1 {
      font-size: 4rem;
      color: var(--color-primary);
      font-family: var(--font-mono);
      font-weight: bold;
    }

    .subtitle {
      color: var(--color-text-secondary);
      font-size: var(--font-size-xl);
      font-style: italic;
    }

    .subsubtitle {
      color: var(--color-text-secondary);
      font-family: var(--font-mono);
      width: 75%;
      margin: 0 auto;
      font-size: var(--font-size-lg);
      font-style: italic;
      background-color: var(--color-bg-light);
      padding: var(--spacing-lg);
      border-radius: var(--radius-lg);
      text-wrap: balance;
    }

    .progress {
      text-align: center;
      align-content: center;
      color: var(--color-text-secondary);
      font-size: var(--font-size-base);
      height: var(--spacing-4xl);
    }


    .code-block-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      background-color: var(--color-code-bg);
      border: var(--border-medium) solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      font-family: var(--font-mono);
      font-size: 1.25rem;
      color: var(--color-text-primary);
      overflow-x: auto;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, calc(var(--shadow-strength) * 0.6));
      max-width: 600px;
      text-align: center;
      text-wrap: nowrap;
      min-height: 4rem;
    }

    .syntax-keyword {
      color: var(--syntax-keyword);
      font-weight: bold;
    }

    .syntax-string {
      color: var(--syntax-string);
    }

    .syntax-number {
      color: var(--syntax-number);
    }

    .syntax-operator {
      color: var(--syntax-operator);
    }

    .syntax-function {
      color: var(--syntax-function);
      font-weight: bold;
    }

    .syntax-comment {
      color: var(--syntax-comment);
      font-style: italic;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-lg);
      max-width: 600px;
      margin: 0 auto;
    }

    .option {
      background-color: var(--color-bg-light);
      border: var(--border-medium) solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg) var(--spacing-xl);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: var(--spacing-lg);
      font-size: var(--font-size-base);
    }

    .option:hover:not(.disabled) {
      background-color: var(--color-bg-lighter);
      border-color: var(--color-border-hover);
    }

    .option.selected {
      border-color: var(--color-primary);
      background-color: rgba(230, 159, 0, 0.15);
    }

    .option.correct {
      border-color: var(--color-accent-green);
      background-color: var(--color-correct-bg);
    }

    .option.incorrect {
      border-color: var(--color-error);
      background-color: var(--color-incorrect-bg);
    }

    .option.disabled:not(.correct):not(.incorrect) {
      opacity: 0.6;
    }

    .option-key {
      background-color: var(--color-border-light);
      color: var(--color-text-primary);
      width: 32px;
      height: 32px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
      font-size: var(--font-size-base);
      pointer-events: none;
    }

    .option-text {
      font-family: var(--font-mono);
      flex: 1;
      font-weight: bold;
      pointer-events: none;
    }

    .explanation {
      display: flex;
      align-items: center;
      justify-content: center;
      max-width: 600px;
      text-align: center;
      padding: var(--spacing-lg);
      background-color: var(--color-bg-light);
      border-radius: var(--radius-md);
      border-left: var(--border-thick) solid var(--color-accent-green);
      visibility: hidden;
      font-size: var(--font-size-lg);
      text-wrap: balance;
      width: 100%;
      min-height: 6rem;
      font-variant-numeric: lining-nums;
    }

    .explanation.correct {
      border-left-color: var(--color-accent-green);
      background-color: var(--color-correct-bg);
    }

    .explanation.incorrect {
      border-left-color: var(--color-error);
      background-color: var(--color-incorrect-bg);
    }


    .button {
      background-color: var(--color-primary);
      color: var(--color-bg-dark);
      border: none;
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg) var(--spacing-3xl);
      font-size: var(--font-size-lg);
      font-weight: bold;
      cursor: pointer;
      max-width: 250px;
      width: 100%;
    }

    .button:hover {
      background-color: var(--color-primary-hover);
    }


    .start-screen,
    .results-screen {
      text-align: center;
    }

    .results-screen h2 {
      font-size: 3rem;
      margin-bottom: var(--spacing-4xl);
      color: var(--color-primary);
    }

    .score {
      font-size: 5rem;
      margin: var(--spacing-4xl) 0;
      color: var(--color-primary);
      font-weight: bold;
    }

    .share-box {
      position: relative;
      background-color: var(--color-bg-light);
      border: var(--border-medium) solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      padding-right: calc(var(--spacing-lg) + 32px);
      margin-top: var(--spacing-xl);
      max-width: 500px;
      width: 100%;
      font-family: var(--font-mono);
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
    }

    .copy-button {
      position: absolute;
      top: var(--spacing-sm);
      right: var(--spacing-sm);
      background-color: var(--color-bg-lighter);
      border: var(--border-thin) solid var(--color-border);
      border-radius: var(--radius-sm);
      padding: var(--spacing-xs);
      cursor: pointer;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
    }

    .copy-button:hover {
      background-color: var(--color-border);
    }

    .copy-icon {
      width: 14px;
      height: 14px;
      stroke: var(--color-text-secondary);
    }

    .button-row {
      display: flex;
      gap: var(--spacing-md);
      margin-top: var(--spacing-lg);
      justify-content: center;
      flex-wrap: wrap;
    }

    .icon-button {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-md) var(--spacing-lg);
      font-size: var(--font-size-base);
      min-width: 100px;
      justify-content: center;
    }

    .button-icon {
      width: 16px;
      height: 16px;
      stroke: currentColor;
    }

    .share-button {
      background-color: var(--color-secondary);
    }

    .share-button:hover {
      background-color: var(--color-secondary-hover);
    }

    .copy-button-main {
      background-color: var(--color-bg-lighter);
      color: var(--color-text-primary);
      border: var(--border-medium) solid var(--color-border);
    }

    .copy-button-main:hover {
      background-color: var(--color-border);
    }

    .footer {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      margin-top: auto;
      padding-bottom: var(--spacing-md);
    }

    .footer a {
      color: var(--color-primary);
      text-decoration: none;
      transition: color var(--transition-fast);
    }

    .footer a:hover {
      color: var(--color-primary-hover);
    }

    .hidden {
      display: none;
    }

    .timezone-note {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      margin-top: calc(var(--spacing-sm) + 2px);
      font-style: italic;
    }

    @media (max-width: 600px) {
      body {
        padding: var(--spacing-sm);
      }

      #startScreen,
      #quizScreen,
      #resultsScreen {
        padding: var(--spacing-md);
      }

      h1 {
        font-size: 2.5rem;
      }

      .subtitle {
        font-size: var(--font-size-lg);
      }

      .subsubtitle {
        font-size: var(--font-size-base);
      }

      .code-block-container {
        font-size: var(--font-size-base);
        padding: var(--spacing-lg);
      }

      .options {
        gap: var(--spacing-md);
      }

      .option {
        padding: var(--spacing-md) var(--spacing-lg);
        font-size: var(--font-size-sm);
      }

      .option-key {
        width: 28px;
        height: 28px;
        font-size: var(--font-size-sm);
      }

      .button {
        font-size: var(--font-size-base);
        max-width: 200px;
      }

      .progress {
        font-size: var(--font-size-sm);
      }

      .score {
        font-size: 3rem;
      }

      .results-screen h2 {
        font-size: 2rem;
      }
    }

    .toast {
      position: fixed;
      bottom: var(--spacing-xl);
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--color-primary);
      color: var(--color-bg-dark);
      padding: var(--spacing-md) calc(var(--spacing-xl) + var(--spacing-xs));
      border-radius: var(--radius-md);
      font-weight: bold;
      opacity: 0;
    }

    .toast.show {
      opacity: 1;
    }

    .theme-toggle {
      position: fixed;
      top: var(--spacing-xl);
      right: var(--spacing-xl);
      background-color: var(--color-bg-light);
      border: var(--border-medium) solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--spacing-sm) var(--spacing-md);
      cursor: pointer;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: var(--font-size-base);
      color: var(--color-text-primary);
    }

    .theme-toggle:hover {
      background-color: var(--color-bg-lighter);
      border-color: var(--color-border-hover);
      transform: translateY(-1px);
    }

    .theme-toggle:active {
      transform: translateY(0);
    }

    .theme-icon {
      width: 20px;
      height: 20px;
      display: block;
    }

    [data-theme="light"] .moon-icon {
      display: none;
    }

    [data-theme="dark"] .sun-icon,
    :root:not([data-theme]) .sun-icon {
      display: none;
    }

    @media (max-width: 600px) {
      .theme-toggle {
        top: var(--spacing-md);
        right: var(--spacing-md);
        padding: var(--spacing-xs) var(--spacing-sm);
      }
    }
  </style>
</head>

<body>
  <!-- Theme toggle button -->
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
    <svg class="theme-icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
    <svg class="theme-icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
  </button>

  <div class="container">
    <div id="startScreen" class="start-screen">
      <div class="start-content">
        <header>
          <h1 id="main-title">new Date("wtf")</h1>
          <p class="subtitle">How well do you know JavaScript's Date class?</p>
        </header>

        <p class="subsubtitle">
          All questions verified using NodeJS 24.4.0 on
          a MacBook Pro set to the BST timezone (UTC+1).
        </p>
        <button class="button" onclick="startQuiz()">Start Quiz</button>
      </div>

      <div class="footer">
        <p>
          made with ❤️ by <a href="https://samwho.dev" target="_blank" rel="noopener">samwho</a>
        </p>
      </div>
    </div>

    <div id="quizScreen" class="hidden">
      <div class="progress">
        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
      </div>

      <div class="code-block-container">
        <div class="code-block" id="codeBlock"></div>
      </div>
      <div class="explanation" id="explanation"></div>

      <div class="options" id="options"></div>

      <button id="nextButton" class="button hidden" onclick="nextQuestion()">Next Question</button>
    </div>

    <div id="resultsScreen" class="results-screen hidden">
      <h2>You got to the end!</h2>
      <div class="score">
        <span id="correctCount">0</span> / <span id="totalCount">0</span>
      </div>
      <p id="resultMessage"></p>

      <div class="share-box">
        <button class="copy-button" onclick="copyShareMessage()" title="Copy to clipboard">
          <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
        </button>
        <div id="shareMessage"></div>
      </div>

      <div class="button-row">
        <button class="button icon-button share-button" onclick="shareResults()">
          <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
            <polyline points="16,6 12,2 8,6"></polyline>
            <line x1="12" y1="2" x2="12" y2="15"></line>
          </svg>
          Share
        </button>
        <button class="button icon-button copy-button-main" onclick="copyShareMessage()">
          <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
          Copy
        </button>
      </div>
      <div class="footer">
        <p>
          made with ❤️ by <a href="https://samwho.dev" target="_blank" rel="noopener">samwho</a>
        </p>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    function getTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        return savedTheme;
      }

      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
        return 'light';
      }

      return 'dark';
    }

    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
    }

    function toggleTheme() {
      const currentTheme = getTheme();
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      setTheme(newTheme);
    }


    document.addEventListener('DOMContentLoaded', () => {
      setTheme(getTheme());
      const mainTitle = document.getElementById('main-title');
      if (mainTitle) {
        mainTitle.innerHTML = highlightJS('new Date("wtf")');
      }

      if (window.matchMedia) {
        const mediaQuery = window.matchMedia('(prefers-color-scheme: light)');
        mediaQuery.addEventListener('change', (e) => {
          if (!localStorage.getItem('theme')) {
            setTheme(e.matches ? 'light' : 'dark');
          }
        });
      }

      document.getElementById('startScreen').classList.remove('hidden');
    });

    setTheme(getTheme());

    function highlightJS(code) {
      const keywords = new Set([
        'new', 'function', 'var', 'let', 'const', 'if', 'else', 'for', 'while', 'do',
        'switch', 'case', 'break', 'continue', 'return', 'try', 'catch', 'finally',
        'throw', 'typeof', 'instanceof', 'in', 'of', 'class', 'extends', 'super',
        'static', 'import', 'export', 'from', 'default', 'async', 'await', 'yield',
        'delete', 'void', 'this', 'null', 'undefined', 'true', 'false'
      ]);

      const operators = new Set([
        '+', '-', '*', '/', '%', '=', '!', '<', '>', '&', '|', '^', '~', '?', ':',
        ';', ',', '.', '(', ')', '[', ']', '{', '}'
      ]);

      function tokenize(code) {
        const tokens = [];
        let i = 0;

        while (i < code.length) {
          const char = code[i];

          if (/\s/.test(char)) {
            let whitespace = '';
            while (i < code.length && /\s/.test(code[i])) {
              whitespace += code[i];
              i++;
            }
            tokens.push({ type: 'whitespace', value: whitespace });
            continue;
          }

          if (char === '"' || char === "'") {
            const quote = char;
            let string = char;
            i++;

            while (i < code.length && code[i] !== quote) {
              if (code[i] === '\\' && i + 1 < code.length) {
                string += code[i] + code[i + 1];
                i += 2;
              } else {
                string += code[i];
                i++;
              }
            }

            if (i < code.length) {
              string += code[i];
              i++;
            }

            tokens.push({ type: 'string', value: string });
            continue;
          }

          if (/\d/.test(char)) {
            let number = '';
            while (i < code.length && /[\d.]/.test(code[i])) {
              number += code[i];
              i++;
            }
            tokens.push({ type: 'number', value: number });
            continue;
          }

          if (/[a-zA-Z_$]/.test(char)) {
            let identifier = '';
            while (i < code.length && /[a-zA-Z0-9_$]/.test(code[i])) {
              identifier += code[i];
              i++;
            }

            const builtinConstructors = new Set(['Date', 'Array', 'Object', 'String', 'Number', 'Boolean', 'RegExp', 'Math', 'JSON']);

            let j = i;
            while (j < code.length && /\s/.test(code[j])) j++;

            if (keywords.has(identifier)) {
              tokens.push({ type: 'keyword', value: identifier });
            } else if (builtinConstructors.has(identifier)) {
              tokens.push({ type: 'function', value: identifier });
            } else if (j < code.length && code[j] === '(') {
              tokens.push({ type: 'function', value: identifier });
            } else {
              tokens.push({ type: 'identifier', value: identifier });
            }
            continue;
          }

          if (operators.has(char)) {
            tokens.push({ type: 'operator', value: char });
            i++;
            continue;
          }

          tokens.push({ type: 'other', value: char });
          i++;
        }

        return tokens;
      }

      function tokensToHtml(tokens) {
        return tokens.map(token => {
          switch (token.type) {
            case 'keyword':
              return `<span class="syntax-keyword">${token.value}</span>`;
            case 'string':
              return `<span class="syntax-string">${token.value}</span>`;
            case 'number':
              return `<span class="syntax-number">${token.value}</span>`;
            case 'function':
              return `<span class="syntax-function">${token.value}</span>`;
            case 'operator':
              return `<span class="syntax-operator">${token.value}</span>`;
            default:
              return token.value;
          }
        }).join('');
      }

      const tokens = tokenize(code);
      return tokensToHtml(tokens);
    }

    const rawQuestions = [
      {
        code: 'new Date("0")',
        options: [
          '1970-01-01T00:00:00.000Z',
          '2000-01-01T00:00:00.000Z',
          'Invalid Date',
          'Throws an error'
        ],
        correct: 1,
        explanation: 'The string "0" is interpreted as the year 2000, not as a timestamp!'
      },
      {
        code: 'new Date(0)',
        options: [
          '1970-01-01T00:00:00.000Z',
          '2000-01-01T00:00:00.000Z',
          'Invalid Date',
          'Throws an error'
        ],
        correct: 0,
        explanation: 'The <i>number</i> 0, as opposed to the string "0", is interpreted as milliseconds since the Unix epoch (Jan 1, 1970).'
      },
      {
        code: 'Date.parse(0) === Date.parse("0")',
        options: [
          'true',
          'false',
          'Throws an error',
          'undefined'
        ],
        correct: 0,
        explanation: 'Both parse to 946684800000 milliseconds! Date.parse only operates on strings, so 0 is coerced to the string "0".'
      },

      {
        code: 'new Date("not a date")',
        options: [
          'null',
          'undefined',
          'Invalid Date',
          'Throws an error'
        ],
        correct: 2,
        explanation: 'Invalid Date is still a Date object! It\'s not null or an error.'
      },
      {
        code: 'new Date("not a date").getTime()',
        options: [
          '0',
          'NaN',
          'null',
          'Throws an error'
        ],
        correct: 1,
        explanation: 'Invalid Date objects return NaN for getTime(). This function returns the number of milliseconds since the Unix epoch for valid dates.'
      },
      {
        code: 'new Date("not a date").toISOString()',
        options: [
          '"Invalid Date"',
          'null',
          'NaN',
          'Throws an error'
        ],
        correct: 3,
        explanation: 'toISOString() throws a RangeError on Invalid Date objects.'
      },
      {
        code: 'new Date("not a date").toTimeString()',
        options: [
          '"Invalid Date"',
          '""',
          'null',
          'Throws an error'
        ],
        correct: 0,
        explanation: 'toTimeString() returns the string "Invalid Date" for invalid dates. 🫠'
      },
      {
        code: 'new Date("1")',
        options: [
          '1970-01-01T00:00:01.000Z',
          '2001-01-01T00:00:00.000Z',
          '0001-01-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 1,
        explanation: 'Unlike "0", "1" is interpreted as a month, and the year defaults to 2001 for some reason.'
      },
      {
        code: 'new Date("2")',
        options: [
          '2002-01-01T00:00:00.000Z',
          '2001-01-02T00:00:00.000Z',
          '2001-02-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 2,
        explanation: '"2" is interpreted as February 2001 (month 2), as you might expect from the previous question.'
      },
      {
        code: 'new Date("12")',
        options: [
          '2012-01-01T00:00:00.000Z',
          '2001-01-12T00:00:00.000Z',
          '2001-12-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 2,
        explanation: 'Also works for December.'
      },
      {
        code: 'new Date("13")',
        options: [
          '2013-01-01T00:00:00.000Z',
          '2001-01-13T00:00:00.000Z',
          '2001-13-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 3,
        explanation: '"13" would be month 13, which doesn\'t exist, so it\'s Invalid Date.'
      },
      {
        code: 'new Date("99") > new Date("100")',
        options: [
          'true',
          'false',
          'Throws an error',
          'NaN'
        ],
        correct: 0,
        explanation: '"99" is year 1999, while "100" is year 0100. 1999 > 0100! Date starts interpreting numbers as years starting at "32".'
      },
      {
        code: 'new Date("49") > new Date("50")',
        options: [
          'true',
          'false',
          'Throws an error',
          'NaN'
        ],
        correct: 0,
        explanation: 'And for some reason "32" to "49" is 2032-2049, while "50" onwards is 1950+. So 2049 > 1950!'
      },
      {
        code: 'new Date("12.1")',
        options: [
          '2001-12-01T00:00:00.000Z',
          '2001-01-01T00:00:00.000Z',
          '2012-01-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 0,
        explanation: '"12.1" is interpreted as the date December 1st, and as before for dates with no year the default is 2001 because of course.'
      },
      {
        code: 'new Date("12.0")',
        options: [
          '2012-01-01T00:00:00.000Z',
          '2001-12-01T00:00:00.000Z',
          '2001-01-12T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 3,
        explanation: 'The .0 is still interpreted as a day, and no month has a 0th day, so this is considered invalid.'
      },
      {
        code: 'new Date("12.-1")',
        options: [
          '2001-12-01T00:00:00.000Z',
          '2001-01-01T00:00:00.000Z',
          '2012-01-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 0,
        explanation: 'The dash here is ignored, so this is interpreted the same as "12.1".'
      },

      {
        code: 'new Date("perhaps 1")',
        options: [
          'Invalid Date',
          '2001-01-01T00:00:00.000Z',
          '1970-01-01T00:00:01.000Z',
          'Throws an error'
        ],
        correct: 1,
        explanation: 'Leading text is always ignored! It finds the "1" and parses it as the month January.'
      },
      {
        code: 'new Date("perhaps")',
        options: [
          'Invalid Date',
          '2001-01-01T00:00:00.000Z',
          '1970-01-01T00:00:01.000Z',
          'Throws an error'
        ],
        correct: 0,
        explanation: 'But you can\'t <i>just</i> have text! It needs a number to parse, so this is Invalid Date. It\'s equivalent to new Date("").'
      },
      {
        code: 'new Date("maybe 1")',
        options: [
          '2001-01-01T00:00:00.000Z',
          '2001-04-30T23:00:00.000Z',
          '2001-05-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 1,
        explanation: '"may" in "maybe" is parsed as the month May! And for some reason this expression cares about your local timezone, which happens to be BST for me right now.',
      },
      {
        code: 'new Date("fourth of may 2010")',
        options: [
          'Invalid Date',
          '2010-05-04T00:00:00.000Z',
          '2010-04-30T23:00:00.000Z',
          '2010-05-01T00:00:00.000Z'
        ],
        correct: 2,
        explanation: '"fourth of" is ignored, this is just parsing "may 2010" and again local timezone is important.',
      },
      {
        code: 'new Date("May 4 UTC")',
        options: [
          'Invalid Date',
          '2001-05-04T00:00:00.000Z',
          '2010-04-30T23:00:00.000Z',
          '2010-05-01T00:00:00.000Z'
        ],
        correct: 1,
        explanation: 'UTC is correctly parsed as a timezone.',
      },
      {
        code: 'new Date("May 4 UTC+1")',
        options: [
          'Invalid Date',
          '2001-05-04T00:00:00.000Z',
          '2001-05-03T23:00:00.000Z',
          '2010-05-01T00:00:00.000Z'
        ],
        correct: 2,
        explanation: 'You can add modifiers to timezones and it works as you would expect.',
      },
      {
        code: 'new Date("May 4 UTC+1:59")',
        options: [
          'Invalid Date',
          '2001-05-04T00:00:00.000Z',
          '2001-05-03T22:01:00.000Z',
          'Throws an error'
        ],
        correct: 2,
        explanation: 'It also supports minutes!',
      },
      {
        code: 'new Date("May 4 UTC+1:60")',
        options: [
          'Invalid Date',
          '2001-05-04T00:00:00.000Z',
          '2001-05-03T22:00:00.000Z',
          '1960-05-03T23:00:00.000Z'
        ],
        correct: 3,
        explanation: 'Until it doesn\'t! 60 is being parsed as the year here, UTC+1 is the timezone.',
      },
      {
        code: 'new Date("1990 2010")',
        options: [
          '1990-01-01T00:00:00.000Z',
          '2010-01-01T00:00:00.000Z',
          '2000-01-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 3,
        explanation: 'No tricks here, just a plain ol\' Invalid Date.'
      },
      {
        code: 'new Date("1990 (2010)")',
        options: [
          '1990-01-01T00:00:00.000Z',
          '2010-01-01T00:00:00.000Z',
          '2000-01-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 0,
        explanation: 'For some reason, parenthesised text is ignored.'
      },
      {
        code: 'new Date("(1990) 2010")',
        options: [
          '1990-01-01T00:00:00.000Z',
          '2010-01-01T00:00:00.000Z',
          '2000-01-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 1,
        explanation: 'No matter where it is.'
      },
      {
        code: 'new Date(-[])',
        options: [
          '1970-01-01T00:00:00.000Z',
          '2000-01-01T00:00:00.000Z',
          'Throws an error',
          'Invalid Date'
        ],
        correct: 0,
        explanation: 'I couldn\'t resist. -[] is coerced to 0, which is interpreted as milliseconds since the Unix epoch (Jan 1, 1970).'
      }
    ];

    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    const questions = rawQuestions.map(question => {
      const optionsWithIndices = question.options.map((option, index) => ({
        text: option,
        originalIndex: index
      }));

      const shuffledOptions = shuffleArray(optionsWithIndices);

      const newCorrectIndex = shuffledOptions.findIndex(
        option => option.originalIndex === question.correct
      );

      return {
        ...question,
        options: shuffledOptions.map(option => option.text),
        correct: newCorrectIndex,
        highlightedCode: highlightJS(question.code)
      };
    });

    let currentQuestionIndex = 0;
    let score = 0;
    let answered = false;
    let chosenAnswer = null;

    function startQuiz() {
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('quizScreen').classList.remove('hidden');
      document.getElementById('totalQuestions').textContent = questions.length;
      showQuestion();
    }

    function showQuestion() {
      const question = questions[currentQuestionIndex];
      document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
      document.getElementById('codeBlock').innerHTML = question.highlightedCode;

      const optionsContainer = document.getElementById('options');
      optionsContainer.innerHTML = '';

      question.options.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'option';
        optionDiv.onclick = () => selectOption(index);

        const keyDiv = document.createElement('div');
        keyDiv.className = 'option-key';
        keyDiv.textContent = (index + 1).toString();

        const textDiv = document.createElement('div');
        textDiv.className = 'option-text';
        textDiv.textContent = option;

        optionDiv.appendChild(keyDiv);
        optionDiv.appendChild(textDiv);
        optionsContainer.appendChild(optionDiv);
      });

      const explanation = document.getElementById('explanation');
      explanation.classList.remove('correct', 'incorrect');
      explanation.style.visibility = 'hidden';
      document.getElementById('nextButton').classList.add('hidden');

      answered = false;
      chosenAnswer = null;
    }

    function selectOption(index) {
      if (answered) return;

      answered = true;
      chosenAnswer = index;
      const question = questions[currentQuestionIndex];
      const options = document.querySelectorAll('.option');

      options[index].classList.add('selected');

      const isCorrect = index === question.correct;

      if (isCorrect) {
        options[index].classList.add('correct');
        score++;
      } else {
        options[index].classList.add('incorrect');
        options[question.correct].classList.add('correct');
      }

      options.forEach(option => option.classList.add('disabled'));

      const explanation = document.getElementById('explanation');
      explanation.innerHTML = `<p>${question.explanation}</p>`;
      explanation.style.visibility = 'visible';
      explanation.classList.add(isCorrect ? 'correct' : 'incorrect');

      document.getElementById('nextButton').classList.remove('hidden');
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < questions.length) {
        showQuestion();
      } else {
        showResults();
      }
    }

    function showResults() {
      document.getElementById('quizScreen').classList.add('hidden');
      document.getElementById('resultsScreen').classList.remove('hidden');
      document.getElementById('correctCount').textContent = score;
      document.getElementById('totalCount').textContent = questions.length;

      const percentage = Math.round((score / questions.length) * 100);
      let message = '';

      if (percentage > 100) {
        message = 'You figured out how to hack the score, nice work!';
      } else if (percentage === 100) {
        message = 'Congrats, you cheated!';
      } else if (percentage >= 80) {
        message = 'It\'s concerning how well you know the JavaScript Date class.';
      } else if (percentage >= 60) {
        message = 'Good score! Now you just have to ask yourself why you know this much about the JavaScript Date class.';
      } else if (percentage >= 25) {
        message = 'It\'s okay, Temporal is coming soon anyway.';
      } else if (percentage >= 0) {
        message = 'You would have scored higher by guessing at random.';
      } else if (percentage < 0) {
        message = 'The smart people that figured out how to hack the score gave themselves values above 0, doofus.';
      }

      document.getElementById('resultMessage').textContent = message;

      const shareText = `I scored ${score}/${questions.length} on https://jsdate.wtf and all I got was this lousy text to share on social media.`;
      document.getElementById('shareMessage').textContent = shareText;

      window.history.replaceState({}, '', window.location.pathname);
    }

    function copyShareMessage() {
      const shareMessage = document.getElementById('shareMessage').textContent;
      navigator.clipboard.writeText(shareMessage);
      showToast('Results copied to clipboard!');
    }

    function shareResults() {
      const shareMessage = document.getElementById('shareMessage').textContent;

      if (navigator.share) {
        navigator.share({
          text: shareMessage
        });
      } else {
        navigator.clipboard.writeText(shareMessage);
        showToast('Results copied to clipboard!');
      }
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    function restartQuiz() {
      currentQuestionIndex = 0;
      score = 0;
      chosenAnswer = null;
      document.getElementById('resultsScreen').classList.add('hidden');
      document.getElementById('startScreen').classList.remove('hidden');
      window.history.replaceState({}, '', window.location.pathname);
    }

    document.addEventListener('keydown', (e) => {
      if (document.getElementById('quizScreen').classList.contains('hidden')) return;

      if (e.key >= '1' && e.key <= '4' && !answered) {
        selectOption(parseInt(e.key) - 1);
      } else if ((e.key === 'Enter' || e.key === ' ') && answered) {
        e.preventDefault();
        nextQuestion();
      }
    });
  </script>
</body>

</html>
